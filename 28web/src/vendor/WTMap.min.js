import e from './map_data'
(function() {
  var c = !-[1],
    t = {
      width: [860, 860],
      height: [630, 630],
      line_color: '#B8BDC1',
      bg_color: '#9cd3e8',
      hover_color: '#ff9900',
      name_size: ['14px', '12px'],
      name_color: '#0222e3',
      name_hover_color: '#0222e3',
      max_level: 1,
      show_baidu: !1,
      show_baidu_level: 0,
      // baidu_api_url: 'http://api.map.baidu.com/getscript?v=2.0&ak=',
      // baidu_key: '20480eb5ebe60b5b3c12178317758876',
      val_format: 'p-c-a',
      keep_old: !0,
      placeholder: '请输入您要查找的城市',
      bdaddress_holder: '请输入您的详细地址',
      bdremark_holder: '例如：东明路御玺大厦A座12楼1201号',
      call_back: !1,
      show_remark: !0,
      readonly: !0,
      check_drag: !1
    }, f, r = 0,
    n = {
      province: '',
      city: '',
      area: '',
      address: '',
      add_remark: '',
      lng: 0,
      lat: 0
    }, i, o, u, l = function() {
      var y, p, et, w, ot, f, o, yt, ht, u, b, ct, lt
      if ($('#WTMap_Main,#WTMap_Cover').remove(), y =
                "<div id='WTMap_Cover'><iframe frameborder='0' onclick='alert(1)'><\/iframe><\/div><div id='WTMap_Main'>",
                r != -1) {
        p = "<div class='wtmap_r_all'><table><tr><td>"
        et = '请选择省份'
        r == 1 && (et = n.province + "<span style='font-size:12px;'>(地图没显示的地区，请直接选择上级城市)<\/span>")
        y += "<div id='WTMap_Top'>" + et +
                    "<input id='btnWTMapSearch' type='button' value=' ' /><input id='txtWTMapSearch' type='text' value='" +
                    t.placeholder + "'><div id='WTMap_S_Result'><\/div><\/div>"
        r == 0 && (y += "<div style='left: 100px;position:absolute; top:300px'>如无法看到地图，请更换浏览器尝试！<\/div>")
        var i, k = 780,
          d = 560,
          ut = 40,
          ft = 60,
          g = n.province == '北京市' || n.province == '天津市' || n.province == '上海市' || n.province == '重庆市',
          at
        if (r == 0) i = e
        else if (r == 1) {
          for (f = 0; f < e.length; f++) {
            if (n.province == e[f].name) {
              if (at = e[f], i = e[f].city, k = e[f].size[0], d = (630 * (k / 860)).toFixed(0), ut = e[f]
                                .size[1], ft = e[f].size[2], g) {
                for (p +=
                                    "<div class='wtmap_l_c'><div class='wtmap-r-ltd' style='float:left;'><a class='wtm_a_txt' txt='" +
                                    n.province + "'>" + n.province + "<\/a><\/div><div style='float:left;'>", w = 0; w <
                                    i.length; w++) {
                  i[w].name != n.province && (p += "<a txt='" + i[w].name +
                                        "' class='wtm_r_txt'>" + i[w].name + '<\/a>')
                }
                p += "<\/div><\/div><div style='clear:both;'><\/div>"
              } else if (n.province == '海南省') {
                for (u = 0; u < i.length; u++) {
                  p += i[u].name == '海口市' || i[
                                        u].name == '三亚市' || i[u].name == '海南直辖市' || i[u].name == '海南直辖县'
                                        ? "<div class='wtmap_l_c' style='" + (u % 2 == 0 ? 'background:#F8F8F8;' : '') +
                                        "'><div class='wtmap-r-ltd' style='float:left;'><a class='wtm_a_txt' txt='" + i[
                                        u].name + "'>" + i[u].name + "<\/a><\/div><div style='float:left;'>"
                                        : "<a txt='" + i[u].name + "' class='wtm_r_txt'>" + i[u].name + '<\/a>', (i[u].name ==
                                        '海口市' || i[u].name == '三亚市' || i[u].name == '东方市' || i[u].name == '中沙群岛及其海域') &&
                                        (p += "<\/div><\/div><div style='clear:both;'><\/div>")
                }
              } else {
                for (u = 0; u < i.length; u++) {
                  for (p += "<div class='wtmap_l_c' style='" + (u % 2 == 0 ? 'background:#F8F8F8;'
                                        : '') +
                                        "'><div class='wtmap-r-ltd' style='float:left;'><a class='wtm_a_txt' txt='" + i[
                                        u].name + "'>" + i[u].name + "<\/a><\/div><div style='float:left;'>", w = 0; w <
                                        i[u].area.length; w++) p += "<a class='wtm_r_txt'>" + i[u].area[w] + '<\/a>'
                  p += "<\/div><\/div><div style='clear:both;'><\/div>"
                }
              }
              p += '<\/td><\/tr><\/table><\/div>'
            }
          }
        }
        for (c || (y += "<svg version='1.1' type='system' x='" + k + "px' y='" + d +
                    "px' viewBox='0 0 860 630' style='position: absolute; width: " + k + 'px; height: ' + d +
                    'px;left:' + ut + 'px;top:' + ft + "px'>"), ot = '', f = 0; f < i.length; f++) {
          var it = i[f].point.split(','),
            nt = 0,
            tt = 0
          for (it.length > 0 && (nt = it[it.length - 2] - 100, tt = it[it.length - 1].replace(' e', '')), i[f]
                        .txt_pos != null && (nt = i[f].txt_pos[0], tt = i[f].txt_pos[1]), o = i[f].point; o.indexOf('$') != -1;) {
            var wt = o.indexOf(',', o.indexOf('$')) != -1 ? o.indexOf(',', o.indexOf('$')) : o.indexOf(' e',
                            o.indexOf('$')),
              rt = o.substring(o.indexOf('$'), wt),
              vt = rt.replace('$', '').replace('A', '').replace('D', ''),
              st
            st = r == 0 ? i[f].sp[vt].pt : at.sp[vt].pt
            yt = rt.substring(rt.length - 1)
            o = yt == 'A' ? o.replace(rt, st.replace(/s/g, ',')) : o.replace(rt, st.split('s').reverse().join(
                            ','))
          }
          if (c) {
            for (ht = o.split('|'), u = 0; u < ht.length; u++) {
              b = i[f].bg ? i[f].bg : t.bg_color, y +=
                                "<v:shape style='cursor: pointer; width: " + k + 'px; height: ' + (r == 0 ? d + 18 : d) +
                                'px; position: absolute; left: ' + ut + 'px; z-index: 1; top: ' + ft +
                                "px; behavior: url(#default#vml); 'ca='tangram__1v'coordsize='860,650'filled='t'fillcolor='" +
                                b + "'stroked='t'strokecolor='" + t.line_color + "'strokeweight='1'path='" + ht[u] +
                                "' txt='" + i[f].name + "'/>", isNaN(nt) || isNaN(tt) || (y +=
                                "<span class='wtm_a_txt' txt='" + i[f].name + "' style='font-weight: bold;font-size:" +
                                t.name_size[r] + ';color:' + t.name_color + ';position:absolute;top:' + tt + 'px;left:' +
                                nt + "px;z-index:2;cursor: pointer;'>" + i[f].name.replace('省', '').replace('市', '').replace(
                                '地区', '').replace('区', '').replace('自治州', '') + '<\/span>')
            }
            f == i.length - 1 && (b = i[f].bg ? i[f].bg : t.bg_color, y +=
                            "<v:shape id='lastshape' style='cursor: pointer; width: " + k + 'px; height: ' + d +
                            'px; position: absolute; left: ' + ut + 'px; z-index: 1; top: ' + ft +
                            "px; behavior: url(#default#vml);  'ca='tangram__1v'coordsize='860,630'filled='t'fillcolor='" +
                            b + "'stroked='t'strokecolor='" + t.line_color + "'strokeweight='1'path='" + i[f].point +
                            "' txt='" + i[f].name + "'/>")
          } else {
            var bt = o.replace(/,/g, ' ').replace(/ e/g, '').replace(/L/g, 'L ').replace(/M/g, 'M '),
              kt = i[f].name,
              pt = bt.split('|')
            for (u = 0; u < pt.length; u++) {
              b = i[f].bg ? i[f].bg : t.bg_color, y +=
                                "<path stroke-linejoin='round' stroke-linecap='round' fill-rule='evenodd' stroke='" + t
                                .line_color + "' stroke-width='1' stroke-dasharray='none' fill='" + b + "' d='" + pt[u] +
                                "' txt='" + kt + "' style='cursor: pointer;'/>", isNaN(nt) || isNaN(tt) || (ot +=
                                "<span class='wtm_a_txt' txt='" + i[f].name + "' style='font-weight: bold;font-size:" +
                                t.name_size[r] + ';color:' + t.name_color + ';position:absolute;top:' + tt + 'px;left:' +
                                nt + "px;z-index:2;cursor: pointer;'>" + i[f].name.replace('省', '').replace('市', '').replace(
                                '地区', '').replace('区', '').replace('自治州', '') + '<\/span>')
            }
          }
        }
        y += c ? '' : '<\/svg>' + ot
      }
      y += '<\/div>'
      $('body').append(y)
      r == 1 ? ($('#WTMap_Main').append(p), $('.wtmap_l_c').each(function() {
        $(this).children().eq(1).width($(this).width() - 5 - $(this).children().eq(0).width())
      })) : r == -1 && h()
      v()
      $('#lastshape').remove()
      a()
      ct = $('#WTMap_Main').find(c ? 'shape' : 'path').add($('#WTMap_Main').find('.wtm_a_txt')).add($(
                '#WTMap_Main').find('.wtm_r_txt'))
      lt = ''
      ct.bind('mouseenter mouseout', function(i) {
        var r, u, f
        $(i.target).attr('class') == 'wtm_r_txt' && (i.type == 'mouseenter' ? $(i.target).css('background', t.hover_color)
                    : $(i.target).css('background', ''), g || n.province == '海南省' || (i.target = $(i.target).parent().prevAll(
                    'div').children()[0]))
        r = $(i.target).attr('class') == 'wtm_a_txt' || $(i.target).attr('class') == 'wtm_r_txt' && (g || n.province ==
                    '海南省') ? $("[txt='" + $(i.target).attr('txt') + "']")[0] : i.target
        i.type == 'mouseenter' && (lt = r && r.fillcolor ? r.fillcolor.value : $(r).attr('fill'))
        u = i.type == 'mouseenter' ? t.hover_color : lt
        f = i.type == 'mouseenter' ? t.name_hover_color : t.name_color
        $("#WTMap_Main span:contains('" + $(r).attr('txt') + "')").css('color', f)
        r && r.fillcolor ? r.fillcolor = u : $(r).attr('fill', u)
      })
      ct.bind('click', function(i) {
        $(i.target).attr('class') == 'wtm_r_txt' && (n.area = $(i.target).text(), g || (i.target = $(i.target).parent()
                    .prevAll('div').children()[0]))
        var f = $(i.target).attr('class') == 'wtm_a_txt' || $(i.target).attr('class') == 'wtm_r_txt' && g ? $(
                    "[txt='" + $(i.target).attr('txt') + "']") : $(i.target),
          u = f.attr('txt'),
          e = u == '香港' || u == '澳门' || u == '台湾'
        if (u == '钓鱼岛' || u == '三沙市') return alert(u + '是中国固有领土，神圣不可侵犯！'), !1
        r == 0 ? n.province = u : r == 1 && (g ? (n.city = n.province, n.area = u == n.city ? '市辖区' : u) : u ==
                    '五指山市' || u == '琼海市' || u == '儋州市' || u == '文昌市' || u == '万宁市' || u == '东方市' ? (n.area = u, n.city =
                    '海南直辖市') : n.province == '海南省' && u.indexOf('县') != -1 && u.indexOf('直辖县') == -1 ? (n.area = u, n.city =
                    '海南直辖县') : (n.city = u, n.area = n.area == '' ? '市辖区' : n.area))
        r < t.max_level && !e ? (r++, l()) : t.show_baidu && typeof BMap !== 'undefined' ? (r = -1, h()) : s()
      })
      $('#txtWTMapSearch').bind('focus blur input propertychange', function(i) {
        if (i.type == 'focus') $(this).val() == t.placeholder ? $(this).val('') : $('#WTMap_S_Result').show()
        else if (i.type == 'blur') {
          $.trim($(this).val()) == '' && $(this).val(t.placeholder), setTimeout(function() {
            $('#WTMap_S_Result').hide()
          }, 200)
        } else if ($.trim($(this).val()) != '' && $(this).val() != t.placeholder) {
          var u = 'http://www.chinawutong.com/ashx/WTMap_Search.ashx?action=search&key=' + escape($(this).val()) +
                        '&t=' + (new Date()).getTime()
          $.ajax({
            url: u,
            type: 'get',
            dataType: 'jsonp',
            jsonp: 'callback',
            success: function(i) {
              i.state == 1 && (i.areas.length > 0 ? ($('#WTMap_S_Result').html(''), $(i.areas).each(function() {
                var n = this.pro + (this.city != '' ? '-' + this.city : '') + (this.area != '' ? '-' +
                                    this.area : '')
                $('#WTMap_S_Result').append('<div>' + n + '<\/div>')
              }), $('#WTMap_S_Result div').bind('click mouseenter mouseout', function(i) {
                if (i.type == 'click') {
                  var u = $(this).text().split('-')
                  u.length == 1 || u.length == 2 ? (n.province = u[0], n.province == '香港' || n.province ==
                                        '澳门' || n.province == '台湾' ? t.show_baidu ? (r = -1, h()) : s() : (u.length ==
                                        2 && (n.city = u[1]), r = 1, l())) : u.length == 3 && (n.province = u[0], n.city =
                                        u[1], n.area = u[2], t.show_baidu ? (r = -1, h()) : s())
                } else {
                  i.type == 'mouseenter' ? $(this).css('background', '#f6f6f6').css('color',
                                        '#2da7d5') : i.type == 'mouseout' && $(this).css('background', '').css('color',
                                        '')
                }
              })) : $('#WTMap_S_Result').html('未匹配到您查找的城市！'))
            },
            timeout: 3e3,
            scriptCharset: 'utf-8'
          })
          $('#WTMap_S_Result').show()
        } else $('#WTMap_S_Result').hide()
      })
    }, v = function() {
      r != 0 && ($('#WTMap_btnReturn').remove(), $('#WTMap_Main').after(
                "<input id='WTMap_btnReturn' type='button' value=' ' />"), $('#WTMap_btnReturn').click(function() {
                  $('.address_group,.hiddenOp,#WTMap_Cover').remove()
                  r = r == -1 ? t.max_level : 0
                  var i = n.province == '香港' || n.province == '澳门' || n.province == '台湾'
                  i && (r = 0)
                  n.address = ''
                  n.add_remark = ''
                  n.lng = ''
                  n.lat = ''
                  r == 1 ? n.area = '' : r == 0 && (n.city = '')
                  l()
                }))
      $('#WTMap_Close').remove()
      $('#WTMap_Main').after("<div id='WTMap_Close'><\/div>")
      $('#WTMap_Close').click(function() {
        s(!0)
      })
      a()
    }, a = function() {
      var n = $(window).width(),
        u = $(window).height(),
        f = $('#WTMap_Main').width(),
        e = $('#WTMap_Main').height(),
        o = $(document).scrollTop(),
        t = n - f < 0 ? 0 : (n - f) / 2,
        i = (u - e < 0 ? 0 : (u - e) / 2) + o
      $('#WTMap_Main').css('left', t + 'px')
      $('#WTMap_Main').css('top', i + 'px')
      $('#WTMap_btnReturn').css('left', t + 750 + 'px')
      $('#WTMap_btnReturn').css('top', i + 20 + 'px')
      $('#WTMap_Close').css('left', t + 830 + 'px')
      $('#WTMap_Close').css('top', i + 'px')
      $('#WTMap_Cover,#WTMap_Cover iframe').width(n).height($(document).height())
      $('#WTMap_Cover').css('top', 0)
      r == -1 && h(!0)
    }, y = function(i) {
      var u, e
      t.show_baidu = !1
      t.val_format = 'p-c-a'
      n = {
        province: '',
        city: '',
        area: '',
        address: '',
        add_remark: '',
        lng: 0,
        lat: 0
      }
      t.keep_old = !0
      t.call_back = !1
      t.show_remark = !0
      t.readonly = !0
      u = new Function('return' + $(i.target).attr('wtmap'))()
      f = $('#' + u.c)
      t.show_baidu = u.bd != null ? u.bd : t.show_baidu
      t.max_level = u.ml ? u.ml : t.max_level
      t.val_format = u.f ? u.f : t.val_format
      t.keep_old = u.o != null ? u.o : t.keep_old
      t.call_back = u.cb != null ? u.cb : t.call_back
      t.show_remark = u.ar != null ? u.ar : t.show_remark
      t.readonly = u.r != null ? u.r : t.readonly
      r = 0
      f && f.attr('wtmap-data') && (e = new Function('return' + f.attr('wtmap-data'))(), e.p && e.p != '' && (t.show_baidu
                ? (n.province = e.p, n.city = e.c, n.area = e.a, n.address = e.d, n.add_remark = e.dr, n.lng = e.ln, n.lat =
                e.la, r = -1) : (n.province = e.p, r = 1, (n.province == '香港' || n.province == '澳门' || n.province ==
                '台湾') && (r = 0))))
      l()
    }, p = function() {
      var i, r
      f && (i = function() {
        var i = t.val_format.replace('p', n.province).replace('c', n.city).replace('a', n.area).replace('d', n.address)
                    .replace('r', n.add_remark != '' ? '(' + n.add_remark + ')' : '')
        n.city != '' || t.show_baidu || (i = n.province)
        f.val(i)
        t.keep_old ? f.attr('wtmap-data', "{p:'" + n.province + "',c:'" + n.city + "',a:'" + n.area + "',d:'" +
                    n.address + "',dr:'" + n.add_remark + "',ln:'" + n.lng + "',la:'" + n.lat + "'}") : f.removeAttr(
                    'wtmap-data')
        t.call_back && typeof WTMap_CallBack !== 'undefined' && WTMap_CallBack(n, f[0])
        f.blur()
      }, t.show_baidu ? (r = new BMap.Point(n.lng, n.lat), o.getLocation(r, function(r) {
        var f = r.addressComponents,
          e = f.province.substring(0, 2),
          o = f.city.substring(0, 2),
          s = n.province.substring(0, 2),
          h = n.city.substring(0, 2),
          u
        if (t.check_drag && (e != s || o != h)) {
          alert('您选择的位置与选择的城市不符，请重新选择！')
          return
        }
        u = w(f)
        n.province = u.province
        n.city = u.city
        n.area != '市辖区' && (n.area = u.area)
        i()
      })) : i())
    }, w = function(n) {
      return n.province = n.province.substr(0, 2), n.city = n.city.substr(0, 2), n.area = n.district.substr(0, 2),
                $.ajax({
                  type: 'POST',
                  dataType: 'json',
                  async: !1,
                  url: '/Ashx/SendGoodsHandler.ashx?t=' + (new Date()).getTime(),
                  data: {
                    action: 'getarea',
                    pro: n.province,
                    city: n.city,
                    area: n.area
                  },
                  success: function(t) {
                    t.status == 1 && (n.province = t.pro, n.city = t.city, n.area = t.area)
                  }
                }), n
    }, s = function(n) {
      $('#WTMap_Main,#WTMap_btnReturn,#WTMap_Close,#WTMap_Cover,.address_group,.hiddenOp').remove()
      n || p()
    }, h = function(r) {
      function h() {
        if (u != null) {
          var n = i.pointToPixel(u.point)
          $('#WTMap_Main').length > 0 && ($('.address_footer').width($('.address_group').width()), $(
                        '.address_group').css('left', n.x - $('.address_group').width() / 2 + $('#WTMap_Main').position()
                        .left).css('top', n.y - $('.address_group').height() - 20 + $('#WTMap_Main').position().top))
          $('.hiddenOp').hide()
          $('.address_group').show()
        }
      }
      function a() {
        var n, t, r
        u != null && (n = i.pointToPixel(u.point), t = i.getSize(), h(), n.x < 0 || n.y < 0 || n.x > t.width ||
                    n.y > t.height ? (r = i.pointToPixel(i.getCenter()), $('#WTMap_Main').length > 0 && $('.hiddenOp').css(
                    'left', r.x + $('#WTMap_Main').position().left - 55).css('top', r.y + $('#WTMap_Main').position().top -
                    25), $('.address_group').hide(), $('.hiddenOp').show()) : ($('.hiddenOp').hide(), $(
                    '.address_group').show()))
      }
      function y() {
        var r = $('#fullAddress').val(),
          o = $.trim($('#addressRemark').val()) != t.bdremark_holder ? $('#addressRemark').val() : '',
          h = '',
          f, e
        if (h = r.indexOf(n.province) == -1 && r.indexOf(n.city) == -1 ? n.province + n.city + r : r, r == '' ||
                    r == '请输入您的详细地址') {
          alert('请填写地址信息！')
          $('#fullAddress').focus()
          return
        }
        f = function() {
          var t = u.point.lng,
            i = u.point.lat
          n.address = r
          n.add_remark = o
          n.lng = t
          n.lat = i
          s()
        }
        i == null && (i = new BMap.Map('WTMap_Main'))
        e = new BMap.LocalSearch(i, {
          onSearchComplete: f
        })
        e.search(r)
      }
      var f, l, c, e
      if (r) {
        a()
        return
      }
      if (i = new BMap.Map('WTMap_Main', {
        enableMapClick: !1
      }), o = new BMap.Geocoder(), n.lng != '' && n.lat != '' && n.lng != '0' && n.lat != '0') {
        f = new BMap.Point(
                    n.lng, n.lat), i.centerAndZoom(f, 16)
      } else if (n.city.indexOf('海南直辖') != -1 && n.area == '市辖区') {
        i.centerAndZoom(n.city.indexOf('市') > -1 ? '琼海市'
                    : '琼中县')
      } else if (n.province == '香港' || n.province == '澳门' || n.province == '台湾') {
        switch (n.province) {
          case '香港':
            f = new BMap.Point(114.18493, 22.324157)
            break
          case '澳门':
            f = new BMap.Point(113.555585, 22.197847)
            break
          case '台湾':
            f = new BMap.Point(121.538312, 25.050665)
        }
        i.centerAndZoom(f, 11)
      } else l = n.area == '市辖区' ? n.city.replace('自治', '') : n.area, i.centerAndZoom(l == '襄阳市' ? '襄阳' : l)
      i.addControl(new BMap.NavigationControl({
        offset: new BMap.Size(10, 100)
      }))
      i.enableScrollWheelZoom(!0)
      i.disableInertialDragging()
      c = function() {
        o.getLocation(i.getCenter(), function(t) {
          var u, r
          i.removeEventListener('tilesloaded', c)
          i.addEventListener('tilesloaded', e)
          f ? e() : (u = t.addressComponents, u.city.substring(0, 1) != n.city.substring(0, 1) ? (r = n.city +
                        (n.area == '市辖区' ? '政府' : n.area), n.city.indexOf('海南直辖') != -1 && n.area == '市辖区' && (r = n.city +
                        (n.city.indexOf('市') > -1 ? '琼海市' : '琼中县')), o.getPoint(r, function(t) {
                          t ? i.centerAndZoom(t, 12) : i.centerAndZoom(n.city)
                        }, n.city)) : e())
        })
      }
      n.area != '市辖区' && setTimeout(function() {
        i.getZoom() < 5 && c()
      }, 500)
      e = function() {
        function p() {
          function t() {
            var t = n.getResults().getPoi(0).point
            i.setCenter(t)
            u.setPosition(t)
            h()
          }
          var n = new BMap.LocalSearch(i, {
            onSearchComplete: t
          })
          n.search(s)
        }
        function a(n, t) {
          u.setPosition(n)
          o.getLocation(n, function(n) {
            var i = n.addressComponents,
              r
            t || (r = i.province + i.city + i.district + i.street + i.streetNumber, $('.address_txt').text(
                            '地址：' + r.replace(i.province, '')), $('.address_tips').html('(您可以拖动小图标到任意位置)'), $(
                            '#fullAddress').css('color', '#000'), f.setInputValue(r.replace(i.province, '')))
          })
        }
        var l = n.province == '香港' || n.province == '澳门' || n.province == '台湾',
          r = '',
          c, f, s
        r += '<div class="address_group">'
        r += ''
        r += '        <div class="address_title">'
        r += '            <span>' + n.province + '<\/span><span ' + (l ? "style='display:none;'" : '') +
                    '>－<\/span><span>' + n.city + '<\/span><span ' + (l ? "style='display:none;'" : '') +
                    '>－<\/span><span>' + n.area + '<\/span>'
        r += '            <span class="close_ico"><\/span>'
        r += '        <\/div>'
        r += '        <div class="address_info">'
        r += '            <div class="address_info_main">'
        r += '                <div class="address_txt">地址：' + (n.address != '' ? n.address.replace(n.province,
                    '') : '<span style="color:red;">请输入或拖动选择地址信息<\/span>') + '<\/div>'
        r += '                <div class="address_tips">(您可以拖动小图标到任意位置)<\/div>'
        r +=
                    '                <div class="address_search"><span>详细地址：<\/span><input id="fullAddress" type="text" value="" style="color:#A9A9A9" /><\/div>'
        r += '                <div style="clear:both;"><\/div>'
        r += '                <div class="address_remark" ' + (t.show_remark ? '' : "style='display:none;'") +
                    '><span>　门牌号：<\/span><input id="addressRemark" type="text" value="' + (n.add_remark !== '' ? n.add_remark
                    : t.bdremark_holder) + '" style="color:#A9A9A9" /><\/div>'
        r += "                <div style=\"clear:both;\"><\/div><a class='address_sure'>确定<\/a>"
        r += '            <\/div>'
        r += '            <div style="clear:both;"><\/div>'
        r += '            <div class="address_footer"><\/div>'
        r += '        <\/div>'
        r +=
                    '        <div id="searchResultPanel" style="border: 1px solid #C0C0C0; width: 150px; height: auto; display: none;"><\/div>'
        r += '    <\/div>'
        r += '    <div class="hiddenOp">'
        r += '        <div class="hiddenReturn" title="返回原位置"><\/div>'
        r += '        <div class="hiddenTip" title="定位到当前位置"><\/div>'
        r += '    <\/div>'
        $('#WTMap_Main').after(r)
        n.address != '' && $('#fullAddress').css('color', '#000')
        n.add_remark != '' && $('#addressRemark').css('color', '#000')
        $('#fullAddress,#addressRemark').bind('focus click blur', function(n) {
          var i = $(n.target),
            r = n.target.id == 'fullAddress' ? t.bdaddress_holder : t.bdremark_holder
          n.type == 'blur' && $.trim(i.val()) == '' ? (i.val(r), i.css('color', '#A9A9A9')) : $.trim(i.val()) ==
                        r && (i.val(''), i.css('color', '#000'))
        })
        $('.close_ico').click(function() {
          $('.address_group').hide()
        })
        $('.address_sure').click(function() {
          try {
            y()
          } catch (n) {
            alert('请拖动图标选择正确地址！')
          }
        })
        $('.hiddenTip').bind('click', function() {
          a(i.getCenter())
          h()
        })
        $('.hiddenReturn').bind('click', function() {
          i.setCenter(u.point)
          h()
        })
        u = new BMap.Marker(i.getCenter())
        u.enableDragging()
        i.addOverlay(u)
        c = i.pointToPixel(u.point)
        $('#WTMap_Main').length > 0 && ($('.address_footer').width($('.address_group').width()), $(
                    '.address_group').css('left', c.x - $('.address_group').width() / 2 + $('#WTMap_Main').position().left)
                    .css('top', c.y - $('.address_group').height() - 20 + $('#WTMap_Main').position().top))
        f = new BMap.Autocomplete({
          input: 'fullAddress',
          location: i,
          onSearchComplete: function() {}
        })
        n.address != '' ? f.setInputValue(n.address) : f.setInputValue('请输入您的详细地址')
        f.addEventListener('onhighlight', function(n) {
          var r = '',
            t = n.fromitem.value,
            i = ''
          n.fromitem.index > -1 && (i = t.province + t.city + t.district + t.street + t.business)
          r = 'FromItem<br />index = ' + n.fromitem.index + '<br />value = ' + i
          i = ''
          n.toitem.index > -1 && (t = n.toitem.value, i = t.province + t.city + t.district + t.street + t.business)
          r += '<br />ToItem<br />index = ' + n.toitem.index + '<br />value = ' + i
          $('#searchResultPanel').html(r)
        })
        f.addEventListener('onconfirm', function(n) {
          var t = n.item.value
          s = t.province + t.city + t.district + t.street + t.business
          $('#searchResultPanel').html('onconfirm<br />index = ' + n.item.index + '<br />myValue = ' + s)
          $('.address_txt').text('地址：' + s.replace(t.province, ''))
          p()
        })
        u.addEventListener('dragstart', function() {
          $('.address_group').hide()
        })
        u.addEventListener('dragging', function() {
          $('.address_group').hide()
        })
        u.addEventListener('dragend', function(n) {
          if (a(n.point), $('#WTMap_Main').length > 0) {
            var t = i.pointToPixel(u.point)
            $('.address_footer').width($('.address_group').width())
            $('.address_group').css('left', t.x - $('.address_group').width() / 2 + $('#WTMap_Main').position()
                            .left).css('top', t.y - $('.address_group').height() - 20 + $('#WTMap_Main').position().top)
          }
          $('.address_group').show()
        })
        u.addEventListener('mouseover', function() {
          $('.address_group').hide()
        })
        u.addEventListener('mouseout', function() {
          $('.address_group').show()
        })
        i.removeEventListener('tilesloaded', e)
        v()
      }
      i.addEventListener('tilesloaded', c)
      i.addEventListener('zoomstart', function() {
        $('.address_group').hide()
      })
      i.addEventListener('zoomend', function() {
        h()
        a()
      })
      i.addEventListener('dragstart', function() {
        $('.address_group').hide()
      })
      i.addEventListener('dragend', function() {
        a()
      })
    }
  $(document).ready(function() {
    $(window).resize(a)
    $('[wtmap]').click(y)
    $('[wtmap]').each(function() {
      var n = new Function('return' + $(this).attr('wtmap'))();
      (n.r == null || n.r == !0) && $('#' + n.c).attr('readonly', !0)
    })
  })
})()
